#!/usr/bin/env node

const ntpl = require('commander'),
    Mustache = require('mustache'),
    fs = require('fs'),
    util = require('./utils/utility')

const supportList = ['yaml', 'yml', 'json'];

let data = {
  tpl: ``,
  params: ``
}

ntpl
  .version('0.2.1', '-v, --version')
  .option('-t, --template <file ...>', 'kubernetes template yaml', templateReader)
  .option('-p, --parameters <file ...>', 'parameters file (yaml|json)', parametersReader)
  .option('-e, --env <key>', 'environment value', envReader)
  .parse(process.argv);

function templateReader(filePath){
  data.tpl = fs.readFileSync(filePath, 'utf8');
}

function parametersReader(filePath) {
  util.isInSupportList(filePath, supportList);
  data.params = util.paramsReader(filePath);
}

function envReader(key) {
  data.params[key] = process.env[key]
}

console.log(Mustache.render(data.tpl, data.params))
